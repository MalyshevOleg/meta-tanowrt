#@TYPE: Machine
#@NAME: mangOH Green with WP7607 (WP7607-1)
#@DESCRIPTION: Machine configuration for the mangOH Green with WP7607 (WP7607-1)

# meta-swi/meta-swi-mdm9x28/
require conf/machine/swi-mdm9x28-wp.conf

MACHINEOVERRIDES =. "swi-mdm9x28-wp:"
MACHINEOVERRIDES =. "mangoh-green-wp7607:"

IMAGE_FSTYPES = "squashfs 4k.ubifs"

#
# Image
#
IMAGE_INSTALL_append = " swi-initscripts "

IMAGE_INSTALL_append = " iproute2 "
IMAGE_INSTALL_append = " picocom "
IMAGE_INSTALL_append = " ppp comgt "

# bsinfo tool from swi:common/recipes-bsp/bsinfo-stub
IMAGE_INSTALL_append = " bsinfo-stub "

# Bootloader
EXTRA_IMAGEDEPENDS += "lk"

# For userapp (UAPP) MTD partition UBI image.
UBI_USERAPP_PATH ?= "${IMGDEPLOYDIR}/${IMAGE_NAME}.userapp"
UBI_USERAPP_SIZE ?= "124MiB"

#
# Kernel
#
PREFERRED_PROVIDER_virtual/kernel = "linux-tano-swi"
PREFERRED_PROVIDER_virtual/kernel_mangoh-green-wp7607 = "linux-tano-swi"
PREFERRED_VERSION_linux-tano-swi = "3.18%"
LINUXLIBCVERSION = "4.19%"
SDKLINUXLIBCVERSION = "4.19%"

PREFERRED_VERSION_xtables-addons = "2.14%"

SERIAL_CONSOLE = "115200 ttyS0"

#
# Machine/distro features
#
MACHINE_FEATURES = "kernel26 apm usbgadget usbhost vfat ext2 ethernet wifi"

#
# QEMU options (runqemu)
#
# No qemu support, yet
MACHINE_FEATURES_remove = "qemu-usermode"
QEMU_TARGETS = "arm"

#
# Other
#
OPENWRT_VERSION_PRODUCT = "mangOH Green with WP7607"
OPENWRT_VERSION_HWREV = "v1"

ENABLE_IMA = "false"
ENABLE_FX30 = "false"
IMA_KERNEL_CMDLINE_OPTIONS = ""

# GPLv2 readline
PREFERRED_VERSION_readline = "8.%"

LEGATO_BUILD ?= "false"

# Note: Supports only single target per machine
LEGATO_ROOTFS_TARGETS = "wp76xx"

KERNEL_BOOT_OPTIONS = "earlyprintk=serial,ttyHSL1,115200 loglevel=7 \
  rootwait rootflags=bulk_read root=/dev/ubiblock0_0 ro rootfstype=squashfs \
  ubi.mtd=13,4096 ubi.block=0,rootfs \
  ubi.mtd=16,4096 \
  overlay_partition=userapp_vol0 \
  console=ttyHSL1,115200 ima_ready=${ENABLE_IMA} \
"

